(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6993:function(e,t,r){Promise.resolve().then(r.bind(r,6504))},6504:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return j}});var n=r(7437),o=r(2265),l=r(9315),i=r.n(l),a=r(2974),c=r(2218),s=r(4839),d=r(6164);function u(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,d.m6)((0,s.W)(t))}let f=(e,t)=>{let r=e.split("/");for(let e of t.split("/"))"."!==e&&""!==e&&(".."===e?r.pop():r.push(e));return r.join("/")},m=(0,c.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),p=o.forwardRef((e,t)=>{let{className:r,variant:o,size:l,asChild:i=!1,...c}=e,s=i?a.g7:"button";return(0,n.jsx)(s,{className:u(m({variant:o,size:l,className:r})),ref:t,...c})});p.displayName="Button";var h=r(518),v=r(7592),b=e=>{let{blob:t,toc:r}=e,[l,a]=(0,o.useState)(0),[c,s]=(0,o.useState)(1),[d,u]=(0,o.useState)(0),[m,b]=(0,o.useState)(!1),g=(0,o.useRef)(0);return(0,o.useEffect)(()=>{t&&r&&i().loadAsync(t).then(e=>{let t="".concat(r[l].path?r[l].path+"/":"").concat(decodeURIComponent(r[l].file)),n=e.file(t);if(n)return n.async("string").then(t=>({chapter:t,zip:e,basePath:r[l].path}));throw Error("content.opf not found")}).then(async e=>{let{chapter:t,zip:r,basePath:n}=e;console.log(n);let o=new DOMParser,l=o.parseFromString(t,"application/xml");if(l){let e=document.getElementById("epub-renderer");if(!e||!e.contentWindow)throw Error("Renderer not found");let t=e.contentDocument||e.contentWindow.document,i=o.parseFromString(l.documentElement.outerHTML,"application/xml");for(let e of Array.from(i.querySelectorAll('link[rel="stylesheet"]'))){let t=f(n,e.getAttribute("href")||""),o=r.file(t);if(o){let t=await o.async("blob"),r=URL.createObjectURL(t);e.setAttribute("href",r)}}for(let e of Array.from(i.querySelectorAll("img"))){let t=f(n,e.getAttribute("src")||""),o=r.file(t);if(o){let t=await o.async("blob"),r=URL.createObjectURL(t);e.setAttribute("src",r)}}let a=new XMLSerializer().serializeToString(i);t.open(),t.write(a),t.close();let c=t.createElement("style"),p=e.scrollWidth?e.scrollWidth/3.5:0;if(c.innerHTML="\n              body {\n                columns: 2;\n                column-fill: auto;\n                word-wrap: break-word;\n                overflow: hidden;\n                column-gap: 20px;\n              }\n\n              a {\n                text-decoration: none;\n              }\n\n              img {\n                max-width: ".concat(p,"px;\n                height: auto;\n              }\n          "),t.head.appendChild(c),Promise.all(Array.from(t.images).map(e=>new Promise(t=>{e.complete?t(void 0):(e.addEventListener("load",t),e.addEventListener("error",t))}))).then(()=>{if(!(null==e?void 0:e.contentWindow)){console.error("Renderer not found");return}let r=t.body.scrollWidth;u(Math.ceil(r/(g.current||e.scrollWidth))),m&&(s(Math.ceil(r/(g.current||e.scrollWidth))),e.contentWindow.scrollTo({left:(d-1)*e.scrollWidth}),b(!1))}),e){let t=()=>{var t;let r=e.contentDocument||(null===(t=e.contentWindow)||void 0===t?void 0:t.document);if(!r||!e.contentWindow)throw Error("Iframe document not found");if(r&&r.body){let t=e.contentWindow.document.body,r=e.contentWindow.getComputedStyle(t),n=parseFloat(r.marginLeft),o=parseFloat(r.marginRight),l=t.clientWidth-n-o+20;l!==g.current&&(g.current=l)}};return e.addEventListener("load",t),()=>{e.removeEventListener("load",t)}}}else throw Error("Body element not found in chapter document")})},[t,r,l,d,m]),(0,n.jsxs)("div",{style:{height:"100%"},children:[(0,n.jsx)("iframe",{id:"epub-renderer",style:{width:"100%",height:"100%"}}),(0,n.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between"},children:[(0,n.jsxs)(p,{variant:"outline",onClick:()=>{if(1!==c||0!==l){if(1===c&&l>0)a(l-1),b(!0);else if(c>1){let e=document.getElementById("epub-renderer");(null==e?void 0:e.contentWindow)?(e.contentWindow.scrollTo({left:(c-2)*g.current}),s(c-1)):console.error("Renderer not found")}}},children:[(0,n.jsx)(h.Z,{}),"Previous"]}),(0,n.jsxs)(p,{variant:"outline",onClick:()=>{let e=document.getElementById("epub-renderer");if(!(null==e?void 0:e.contentWindow)){console.error("Renderer not found");return}if(c<d){let t=c*g.current;e.contentWindow.scrollTo({left:t}),s(c+1)}else l<r.length-1&&(a(l+1),s(1))},children:["Next",(0,n.jsx)(v.Z,{})]})]})]})};let g="application/xml",y=async e=>{let t=new FileReader;return new Promise((r,n)=>{t.onload=async function(e){try{var t,o,l,a;let n=null===(t=e.target)||void 0===t?void 0:t.result,c=await i().loadAsync(n),s=await (null===(o=c.file("META-INF/container.xml"))||void 0===o?void 0:o.async("string")),d=w(s),u=null==d?void 0:d.split("content.opf")[0];if(!s)throw Error("Missing container.xml in EPUB structure.");if(!d)throw Error("Failed to find content.opf path in container.xml.");let f=await (null===(l=c.file(d))||void 0===l?void 0:l.async("string")),[m,p]=x(f),h=c.file("".concat(u).concat(m.coverPath)),[v,b]=await Promise.all([(null==h?void 0:h.async("blob"))||null,null===(a=c.file("".concat(u).concat(p)))||void 0===a?void 0:a.async("string")]);m.coverBlob=v,m.toc=E(b,u),r(m)}catch(e){console.error("Error reading EPUB file:",e),n(e)}},t.readAsArrayBuffer(e)})},w=e=>{try{let t=new DOMParser().parseFromString(e,g).querySelector("rootfile");if(t)return t.getAttribute("full-path")}catch(e){console.error("Error parsing XML:",e)}return null},x=e=>{var t;let r=new DOMParser().parseFromString(e,g);return[{title:(()=>{let e=r.querySelector("metadata > title");return e?e.textContent:null})(),creator:(()=>{let e=r.querySelector("metadata > creator");return e?e.textContent:null})(),publisher:(()=>{let e=r.querySelector("metadata > publisher");return e?e.textContent:null})(),identifier:(()=>{let e=r.querySelector("metadata > identifier");return e?e.textContent:null})(),date:(()=>{let e=r.querySelector("metadata > date");return e?e.textContent:null})(),coverPath:(()=>{let e=r.querySelector("metadata > meta[name='cover']"),t=e?e.getAttribute("content"):null;if(t){let e=r.querySelector("manifest > item[id='".concat(t,"']"));return e?e.getAttribute("href"):null}return null})(),coverBlob:null,toc:[]},null===(t=r.querySelector("manifest > item[id='ncx']"))||void 0===t?void 0:t.getAttribute("href")]},E=(e,t)=>{let r=[],n=new DOMParser().parseFromString(e,g);return console.log(n),n.querySelectorAll("navPoint").forEach(e=>{var n,o;let l=(null===(n=e.querySelector("navLabel > text"))||void 0===n?void 0:n.textContent)||null,i=(null===(o=e.querySelector("content"))||void 0===o?void 0:o.getAttribute("src"))||null,a=(i?"".concat(t).concat(i):"").split("/"),c=a.pop()||"",s=a.join("/");r.push({text:l,path:s,file:c})}),r},S=o.forwardRef((e,t)=>{let{className:r,type:o,...l}=e;return(0,n.jsx)("input",{type:o,className:u("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...l})});S.displayName="Input",r(8345);var j=function(){let e=(0,o.useRef)(null),[t,r]=(0,o.useState)(),[l,i]=(0,o.useState)({name:"",size:0,blob:null}),a=async e=>{let t=e.target.files;if(!t)return;let n=t[0];if(n){let e=(n.size/1048576).toFixed(2),t=await new Promise((e,t)=>{let r=new FileReader;r.onload=()=>{e(r.result)},r.onerror=()=>{t(Error("Error reading file"))},r.readAsArrayBuffer(n)});i({name:n.name,size:parseFloat(e),blob:t});let o=await y(n);r({title:o.title,creator:null==o?void 0:o.creator,publisher:null==o?void 0:o.publisher,identifier:null==o?void 0:o.identifier,date:null==o?void 0:o.date,coverPath:null==o?void 0:o.coverPath,toc:null==o?void 0:o.toc.map(e=>({...e,text:e.text||""}))}),console.log(o)}};return(0,n.jsxs)("div",{className:"app",children:[(0,n.jsxs)("div",{className:"uploadEpub",children:[(0,n.jsx)(S,{id:"picture",type:"file",accept:".epub",ref:e,style:{display:"none"},onChange:a}),(0,n.jsx)(p,{type:"button",onClick:()=>{e.current&&e.current.click()},children:"Select EPUB"}),(0,n.jsxs)("span",{style:{marginLeft:"10px"},children:[l.name," ",l.name?l.size+"MB":null]})]}),(0,n.jsx)("div",{style:{height:"100%"},children:(null==t?void 0:t.toc)?(0,n.jsx)(b,{blob:l.blob,toc:null==t?void 0:t.toc}):null})]})}},8345:function(){}},function(e){e.O(0,[940,771,971,23,744],function(){return e(e.s=6993)}),_N_E=e.O()}]);