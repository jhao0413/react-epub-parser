(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6993:function(e,t,r){Promise.resolve().then(r.bind(r,6504))},6504:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return j}});var n=r(7437),o=r(2265),l=r(9315),i=r.n(l),a=r(2974),c=r(2218),s=r(4839),u=r(6164);function d(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,u.m6)((0,s.W)(t))}let f=(e,t)=>{let r=e.split("/");for(let e of t.split("/"))"."!==e&&""!==e&&(".."===e?r.pop():r.push(e));return r.join("/")},m=(0,c.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),p=o.forwardRef((e,t)=>{let{className:r,variant:o,size:l,asChild:i=!1,...c}=e,s=i?a.g7:"button";return(0,n.jsx)(s,{className:d(m({variant:o,size:l,className:r})),ref:t,...c})});p.displayName="Button";var h=r(518),v=r(7592),b=e=>{let{blob:t,toc:r}=e,[l,a]=(0,o.useState)(0),[c,s]=(0,o.useState)(1),u=(0,o.useRef)(!1),d=(0,o.useRef)(0),m=(0,o.useRef)(0),[b,y]=(0,o.useState)(0);(0,o.useEffect)(()=>{if(!t||!r)return;i().loadAsync(t).then(async t=>{let{chapterContent:r,zip:l,basePath:i}=await e(t),s=o(await n(r,l,i)),u=s.contentDocument||s.contentWindow&&s.contentWindow.document;return u?a(s,u):console.error("Iframe document not found"),c(s)}).catch(e=>{console.error(e)});let e=async e=>{let t="".concat(r[l].path?r[l].path+"/":"").concat(decodeURIComponent(r[l].file)),n=e.file(t);if(n)return{chapterContent:await n.async("string"),zip:e,basePath:r[l].path};throw Error("Content file not found")},n=async(e,t,r)=>{let n=new DOMParser,o=n.parseFromString(e,"application/xml");if(!o)throw Error("Failed to parse chapter content");let l=n.parseFromString(o.documentElement.outerHTML,"application/xml");for(let e of Array.from(l.querySelectorAll('link[rel="stylesheet"]'))){let n=f(r,e.getAttribute("href")||""),o=t.file(n);if(o){let t=await o.async("blob"),r=URL.createObjectURL(t);e.setAttribute("href",r)}}for(let e of Array.from(l.querySelectorAll("img"))){let n=f(r,e.getAttribute("src")||""),o=t.file(n);if(o){let t=await o.async("blob"),r=URL.createObjectURL(t);e.setAttribute("src",r)}}return new XMLSerializer().serializeToString(l)},o=e=>{let t=document.getElementById("epub-renderer");if(!t||!t.contentWindow)throw Error("Renderer not found");let r=t.contentDocument||t.contentWindow&&t.contentWindow.document;r.open(),r.write(e),r.close();let n=r.createElement("style"),o=t.scrollWidth?t.scrollWidth/3.5:0;return n.innerHTML="\n        body {\n          columns: 2;\n          column-fill: auto;\n          word-wrap: break-word;\n          overflow: hidden;\n          column-gap: 20px;\n        }\n  \n        a {\n          text-decoration: none;\n        }\n  \n        img {\n          max-width: ".concat(o,"px;\n          height: auto;\n        }\n      "),r.head.appendChild(n),t},a=(e,t)=>{Promise.all(Array.from(t.images).map(e=>new Promise(t=>{e.complete?t(void 0):(e.addEventListener("load",t),e.addEventListener("error",t))}))).then(()=>{if(!(null==e?void 0:e.contentWindow)){console.error("Renderer not found");return}})},c=e=>{e.style.visibility="hidden";let t=()=>{var r;let n=e.contentDocument||(null===(r=e.contentWindow)||void 0===r?void 0:r.document);if(!n||!e.contentWindow)throw Error("Iframe document not found");if(n.body){let r=e.contentWindow.document.body,o=e.contentWindow.getComputedStyle(r),l=parseFloat(o.marginLeft),i=parseFloat(o.marginRight),a=r.clientWidth-l-i+20;a!==d.current&&(d.current=a);let c=n.body.scrollWidth,f=c/d.current;if(f-Math.floor(f)<=.5){let t=e.contentWindow.document.createElement("div");t.style.height="100%",r.appendChild(t)}m.current=Math.ceil(c/d.current),y(m.current),u.current?(e.contentWindow.scrollTo({left:(m.current-1)*d.current}),u.current=!1,s(Math.ceil(c/d.current))):e.contentWindow.scrollTo({left:0}),e.style.visibility="visible",e.removeEventListener("load",t)}};e.addEventListener("load",t)}},[t,r,l]);let g=()=>{let e=document.getElementById("epub-renderer");return(null==e?void 0:e.contentWindow)?e.contentWindow:(console.error("Renderer not found"),null)};return(0,n.jsxs)("div",{style:{height:"100%"},children:[(0,n.jsx)("iframe",{id:"epub-renderer",style:{width:"100%",height:"100%"}}),(0,n.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between"},children:[(0,n.jsxs)(p,{variant:"outline",onClick:()=>{if(1!==c||0!==l){if(1===c&&l>0)u.current=!0,a(l-1);else if(c>1){let e=g();if(!e)return;e.scrollTo({left:(c-2)*d.current}),s(c-1)}}},children:[(0,n.jsx)(h.Z,{}),"Previous"]}),(0,n.jsxs)(p,{variant:"outline",onClick:()=>{let e=g();e&&(c<m.current?(e.scrollTo({left:c*d.current}),s(c+1)):l<r.length-1&&(s(1),a(l+1)))},children:["Next",(0,n.jsx)(v.Z,{})]})]}),(0,n.jsxs)("div",{children:[c,"/",b]})]})};let y="application/xml",g=async e=>{let t=new FileReader;return new Promise((r,n)=>{t.onload=async function(e){try{var t,o,l,a;let n=null===(t=e.target)||void 0===t?void 0:t.result,c=await i().loadAsync(n),s=await (null===(o=c.file("META-INF/container.xml"))||void 0===o?void 0:o.async("string")),u=w(s),d=null==u?void 0:u.split("content.opf")[0];if(!s)throw Error("Missing container.xml in EPUB structure.");if(!u)throw Error("Failed to find content.opf path in container.xml.");let f=await (null===(l=c.file(u))||void 0===l?void 0:l.async("string")),[m,p]=x(f),h=c.file("".concat(d).concat(m.coverPath)),[v,b]=await Promise.all([(null==h?void 0:h.async("blob"))||null,null===(a=c.file("".concat(d).concat(p)))||void 0===a?void 0:a.async("string")]);m.coverBlob=v,m.toc=E(b,d),r(m)}catch(e){console.error("Error reading EPUB file:",e),n(e)}},t.readAsArrayBuffer(e)})},w=e=>{try{let t=new DOMParser().parseFromString(e,y).querySelector("rootfile");if(t)return t.getAttribute("full-path")}catch(e){console.error("Error parsing XML:",e)}return null},x=e=>{var t;let r=new DOMParser().parseFromString(e,y);return[{title:(()=>{let e=r.querySelector("metadata > title");return e?e.textContent:null})(),creator:(()=>{let e=r.querySelector("metadata > creator");return e?e.textContent:null})(),publisher:(()=>{let e=r.querySelector("metadata > publisher");return e?e.textContent:null})(),identifier:(()=>{let e=r.querySelector("metadata > identifier");return e?e.textContent:null})(),date:(()=>{let e=r.querySelector("metadata > date");return e?e.textContent:null})(),coverPath:(()=>{let e=r.querySelector("metadata > meta[name='cover']"),t=e?e.getAttribute("content"):null;if(t){let e=r.querySelector("manifest > item[id='".concat(t,"']"));return e?e.getAttribute("href"):null}return null})(),coverBlob:null,toc:[]},null===(t=r.querySelector("manifest > item[id='ncx']"))||void 0===t?void 0:t.getAttribute("href")]},E=(e,t)=>{let r=[],n=new DOMParser().parseFromString(e,y);return console.log(n),n.querySelectorAll("navPoint").forEach(e=>{var n,o;let l=(null===(n=e.querySelector("navLabel > text"))||void 0===n?void 0:n.textContent)||null,i=(null===(o=e.querySelector("content"))||void 0===o?void 0:o.getAttribute("src"))||null,a=(i?"".concat(t).concat(i):"").split("/"),c=a.pop()||"",s=a.join("/");r.push({text:l,path:s,file:c})}),r},S=o.forwardRef((e,t)=>{let{className:r,type:o,...l}=e;return(0,n.jsx)("input",{type:o,className:d("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...l})});S.displayName="Input",r(8345);var j=function(){let e=(0,o.useRef)(null),[t,r]=(0,o.useState)(),[l,i]=(0,o.useState)({name:"",size:0,blob:null}),a=async e=>{let t=e.target.files;if(!t)return;let n=t[0];if(n){let e=(n.size/1048576).toFixed(2),t=await new Promise((e,t)=>{let r=new FileReader;r.onload=()=>{e(r.result)},r.onerror=()=>{t(Error("Error reading file"))},r.readAsArrayBuffer(n)});i({name:n.name,size:parseFloat(e),blob:t});let o=await g(n);r({title:o.title,creator:null==o?void 0:o.creator,publisher:null==o?void 0:o.publisher,identifier:null==o?void 0:o.identifier,date:null==o?void 0:o.date,coverPath:null==o?void 0:o.coverPath,toc:null==o?void 0:o.toc.map(e=>({...e,text:e.text||""}))}),console.log(o)}};return(0,n.jsxs)("div",{className:"app",children:[(0,n.jsxs)("div",{className:"uploadEpub",children:[(0,n.jsx)(S,{id:"picture",type:"file",accept:".epub",ref:e,style:{display:"none"},onChange:a}),(0,n.jsx)(p,{type:"button",onClick:()=>{e.current&&e.current.click()},children:"Select EPUB"}),(0,n.jsxs)("span",{style:{marginLeft:"10px"},children:[l.name," ",l.name?l.size+"MB":null]})]}),(0,n.jsx)("div",{style:{height:"100%"},children:(null==t?void 0:t.toc)?(0,n.jsx)(b,{blob:l.blob,toc:null==t?void 0:t.toc}):null})]})}},8345:function(){}},function(e){e.O(0,[940,771,971,23,744],function(){return e(e.s=6993)}),_N_E=e.O()}]);