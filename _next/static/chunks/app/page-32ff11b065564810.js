(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8410:function(e,t,n){Promise.resolve().then(n.bind(n,4955))},4955:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return S}});var r=n(7437),o=n(2265),l=n(9315),i=n.n(l),a=n(2974),s=n(2218),d=n(4839),c=n(6164);function u(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,c.m6)((0,d.W)(t))}let f=(0,s.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),h=o.forwardRef((e,t)=>{let{className:n,variant:o,size:l,asChild:i=!1,...s}=e,d=i?a.g7:"button";return(0,r.jsx)(d,{className:u(f({variant:o,size:l,className:n})),ref:t,...s})});h.displayName="Button";var p=n(518),m=n(7592),v=e=>{let{blob:t,toc:n}=e,[l,a]=(0,o.useState)(0),[s,d]=(0,o.useState)(1),[c,u]=(0,o.useState)(0);return(0,o.useEffect)(()=>{t&&n&&i().loadAsync(t).then(e=>{let t="".concat(n[l].path?n[l].path+"/":"").concat(decodeURIComponent(n[l].file)),r=e.file(t);if(r)return r.async("string").then(t=>({chapter:t,zip:e,basePath:n[l].path}));throw Error("content.opf not found")}).then(e=>{let{chapter:t}=e,n=new DOMParser().parseFromString(t,"application/xml");if(n){let e=document.getElementById("epub-renderer");if(!e||!e.contentWindow)throw Error("Renderer not found");let t=e.contentDocument||e.contentWindow.document;t.open(),t.write(n.documentElement.outerHTML),t.close();let r=t.createElement("style");r.innerHTML="\n              body {\n                columns: 2;\n                column-fill: auto;\n                word-wrap: break-word;\n                overflow: hidden;\n              }\n\n              a {\n                text-decoration: none;\n              }\n          ",t.head.appendChild(r),u(Math.ceil(t.body.scrollWidth/(null==e?void 0:e.scrollWidth))),console.log(c)}else throw Error("Body element not found in chapter document")})},[t,n,l,c]),(0,r.jsxs)("div",{style:{height:"100%"},children:[(0,r.jsx)("iframe",{id:"epub-renderer",style:{width:"100%",height:"100%"}}),(0,r.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between"},children:[(0,r.jsxs)(h,{variant:"outline",onClick:()=>{if((1!==s||0!==l)&&(1===s&&l>0&&a(e=>e-1),s>1)){let e=document.getElementById("epub-renderer");e&&e.contentWindow?e.contentWindow.scrollTo({left:-s*e.scrollWidth}):console.error("Renderer not found")}},children:[(0,r.jsx)(p.Z,{}),"Previous"]}),(0,r.jsxs)(h,{variant:"outline",onClick:()=>{if(s<c){d(e=>e+1);let e=document.getElementById("epub-renderer");e&&e.contentWindow?e.contentWindow.scrollTo({left:s*e.scrollWidth}):console.error("Renderer not found")}else a(e=>e+1),d(1)},children:["Next",(0,r.jsx)(m.Z,{})]})]})]})};let b="application/xml",g=async e=>{let t=new FileReader;return new Promise((n,r)=>{t.onload=async function(e){try{var t,o,l,a;let r=null===(t=e.target)||void 0===t?void 0:t.result,s=await i().loadAsync(r),d=await (null===(o=s.file("META-INF/container.xml"))||void 0===o?void 0:o.async("string")),c=y(d),u=null==c?void 0:c.split("content.opf")[0];if(!d)throw Error("Missing container.xml in EPUB structure.");if(!c)throw Error("Failed to find content.opf path in container.xml.");let f=await (null===(l=s.file(c))||void 0===l?void 0:l.async("string")),[h,p]=x(f),m=s.file("".concat(u).concat(h.coverPath)),[v,b]=await Promise.all([(null==m?void 0:m.async("blob"))||null,null===(a=s.file("".concat(u).concat(p)))||void 0===a?void 0:a.async("string")]);h.coverBlob=v,h.toc=w(b,u),n(h)}catch(e){console.error("Error reading EPUB file:",e),r(e)}},t.readAsArrayBuffer(e)})},y=e=>{try{let t=new DOMParser().parseFromString(e,b).querySelector("rootfile");if(t)return t.getAttribute("full-path")}catch(e){console.error("Error parsing XML:",e)}return null},x=e=>{var t;let n=new DOMParser().parseFromString(e,b);return[{title:(()=>{let e=n.querySelector("metadata > title");return e?e.textContent:null})(),creator:(()=>{let e=n.querySelector("metadata > creator");return e?e.textContent:null})(),publisher:(()=>{let e=n.querySelector("metadata > publisher");return e?e.textContent:null})(),identifier:(()=>{let e=n.querySelector("metadata > identifier");return e?e.textContent:null})(),date:(()=>{let e=n.querySelector("metadata > date");return e?e.textContent:null})(),coverPath:(()=>{let e=n.querySelector("metadata > meta[name='cover']"),t=e?e.getAttribute("content"):null;if(t){let e=n.querySelector("manifest > item[id='".concat(t,"']"));return e?e.getAttribute("href"):null}return null})(),coverBlob:null,toc:[]},null===(t=n.querySelector("manifest > item[id='ncx']"))||void 0===t?void 0:t.getAttribute("href")]},w=(e,t)=>{let n=[],r=new DOMParser().parseFromString(e,b);return console.log(r),r.querySelectorAll("navPoint").forEach(e=>{var r,o;let l=(null===(r=e.querySelector("navLabel > text"))||void 0===r?void 0:r.textContent)||null,i=(null===(o=e.querySelector("content"))||void 0===o?void 0:o.getAttribute("src"))||null,a=(i?"".concat(t).concat(i):"").split("/"),s=a.pop()||"",d=a.join("/");n.push({text:l,path:d,file:s})}),n},E=o.forwardRef((e,t)=>{let{className:n,type:o,...l}=e;return(0,r.jsx)("input",{type:o,className:u("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...l})});E.displayName="Input",n(269);var S=function(){let e=(0,o.useRef)(null),[t,n]=(0,o.useState)(),[l,i]=(0,o.useState)({name:"",size:0,blob:null}),a=async e=>{let t=e.target.files;if(!t)return;let r=t[0];if(r){let e=(r.size/1048576).toFixed(2),t=await new Promise((e,t)=>{let n=new FileReader;n.onload=()=>{e(n.result)},n.onerror=()=>{t(Error("Error reading file"))},n.readAsArrayBuffer(r)});i({name:r.name,size:parseFloat(e),blob:t});let o=await g(r);n({title:o.title,creator:null==o?void 0:o.creator,publisher:null==o?void 0:o.publisher,identifier:null==o?void 0:o.identifier,date:null==o?void 0:o.date,coverPath:null==o?void 0:o.coverPath,toc:null==o?void 0:o.toc.map(e=>({...e,text:e.text||""}))}),console.log(o)}};return(0,r.jsxs)("div",{className:"app",children:[(0,r.jsxs)("div",{className:"uploadEpub",children:[(0,r.jsx)(E,{id:"picture",type:"file",accept:".epub",ref:e,style:{display:"none"},onChange:a}),(0,r.jsx)(h,{type:"button",onClick:()=>{e.current&&e.current.click()},children:"Select EPUB"}),(0,r.jsxs)("span",{style:{marginLeft:"10px"},children:[l.name," ",l.name?l.size+"MB":null]})]}),(0,r.jsx)("div",{style:{height:"100%"},children:(null==t?void 0:t.toc)?(0,r.jsx)(v,{blob:l.blob,toc:null==t?void 0:t.toc}):null})]})}},269:function(){}},function(e){e.O(0,[983,771,971,23,744],function(){return e(e.s=8410)}),_N_E=e.O()}]);