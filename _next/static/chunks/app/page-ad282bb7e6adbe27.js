(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6993:function(e,t,r){Promise.resolve().then(r.bind(r,500))},500:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return D}});var n=r(7437),o=r(2265),i=r(9315),l=r.n(i),a=r(1538),s=r(2218),c=r(4839),d=r(6164);function u(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,d.m6)((0,c.W)(t))}let f=(e,t)=>{let r=e.split("/");for(let e of t.split("/"))"."!==e&&""!==e&&(".."===e?r.pop():r.push(e));return r.join("/")},h=(0,s.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),m=o.forwardRef((e,t)=>{let{className:r,variant:o,size:i,asChild:l=!1,...s}=e,c=l?a.g7:"button";return(0,n.jsx)(c,{className:u(h({variant:o,size:i,className:r})),ref:t,...s})});m.displayName="Button";var p=r(518),x=r(7592),v=r(6648),b=r(1288);let y=b.zt,g=b.fC,w=b.xz,E=o.forwardRef((e,t)=>{let{className:r,sideOffset:o=4,...i}=e;return(0,n.jsx)(b.h_,{children:(0,n.jsx)(b.VY,{ref:t,sideOffset:o,className:u("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...i})})});E.displayName=b.VY.displayName;var j=r(1276);let B=o.forwardRef((e,t)=>{let{className:r,children:o,...i}=e;return(0,n.jsxs)(j.fC,{ref:t,className:u("relative overflow-hidden",r),...i,children:[(0,n.jsx)(j.l_,{className:"h-full w-full rounded-[inherit]",children:o}),(0,n.jsx)(A,{}),(0,n.jsx)(j.Ns,{})]})});B.displayName=j.fC.displayName;let A=o.forwardRef((e,t)=>{let{className:r,orientation:o="vertical",...i}=e;return(0,n.jsx)(j.gb,{ref:t,orientation:o,className:u("flex touch-none select-none transition-colors","vertical"===o&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===o&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...i,children:(0,n.jsx)(j.q4,{className:"relative flex-1 rounded-full bg-border"})})});A.displayName=j.gb.displayName;var C=r(8353),N=r(1222);let k={normal:{rotate:0,y:0,opacity:1},animate:e=>({rotate:1===e?45:3===e?-45:0,y:1===e?6:3===e?-6:0,opacity:2===e?0:1,transition:{type:"spring",stiffness:260,damping:20}})},S=e=>{let{isOpen:t}=e,r=(0,C._)();return(0,o.useEffect)(()=>{t?r.start("animate"):r.start("normal")},[t,r]),(0,n.jsx)("div",{className:"cursor-pointer select-none p-2 rounded-md transition-colors duration-200 flex items-center justify-center",children:(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)(N.E.line,{x1:"4",y1:"6",x2:"20",y2:"6",variants:k,animate:r,custom:1}),(0,n.jsx)(N.E.line,{x1:"4",y1:"12",x2:"20",y2:"12",variants:k,animate:r,custom:2}),(0,n.jsx)(N.E.line,{x1:"4",y1:"18",x2:"20",y2:"18",variants:k,animate:r,custom:3})]})})};var F=e=>{let{bookBasicInfo:t,currentChapter:r,setCurrentChapter:i}=e,[l,a]=(0,o.useState)(!1),[s,c]=(0,o.useState)(null);return(0,o.useEffect)(()=>{if(t.coverBlob){let e=URL.createObjectURL(t.coverBlob);return c(e),()=>{URL.revokeObjectURL(e)}}},[t]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"w-12 h-12 bg-white rounded-full shadow-md flex items-center justify-center cursor-pointer z-50",onClick:()=>{a(!l)},children:(0,n.jsx)(S,{isOpen:l})}),(0,n.jsx)("div",{className:"fixed top-0 left-0 w-screen h-screen bg-black bg-opacity-10 z-10 transition-opacity duration-500 ".concat(l?"opacity-100":"opacity-0 pointer-events-none"),onClick:()=>{a(!1)}}),(0,n.jsxs)("div",{className:"w-[22vw] h-[86vh] bg-white rounded-lg fixed top-[7vh] right-[10%] z-10 rounded-[28px] transition-transform transition-opacity duration-500 transform ".concat(l?"opacity-100":"opacity-0 pointer-events-none"," shadow-md"),children:[(0,n.jsxs)("div",{className:"flex px-6 pt-8 pb-4",children:[s&&(0,n.jsx)(v.default,{className:"shadow-md rounded-md",src:s,alt:"Book Cover",width:80,height:160,style:{objectFit:"cover",width:"80px",height:"auto"}}),(0,n.jsxs)("div",{className:"w-4/6 mx-4",children:[(0,n.jsx)(y,{children:(0,n.jsxs)(g,{children:[(0,n.jsx)(w,{children:(0,n.jsx)("h2",{className:"font-bold truncate w-5/6 text-lg",children:t.title})}),(0,n.jsx)(E,{children:(0,n.jsx)("p",{children:t.title})})]})}),(0,n.jsx)("p",{className:"text-slate-500",children:t.creator})]})]}),(0,n.jsx)("div",{children:(0,n.jsx)(B,{className:"h-[68vh] w-full",children:(0,n.jsx)("div",{children:t.toc.map((e,t)=>(0,n.jsx)("div",{className:"py-4 px-8 hover:bg-blue-50 cursor-pointer ",children:(0,n.jsx)("a",{onClick:()=>i(t),className:"block text-sm ".concat(r===t?"text-blue-500":"text-slate-500"),children:e.text})},t))})})})]})]})},L=e=>{let{blob:t,bookBasicInfo:r}=e,[i,a]=(0,o.useState)(0),[s,c]=(0,o.useState)(1),d=(0,o.useRef)(!1),u=(0,o.useRef)(0),h=(0,o.useRef)(0);(0,o.useEffect)(()=>{if(!t||!r.toc)return;l().loadAsync(t).then(async t=>{let{chapterContent:r,zip:i,basePath:l}=await e(t),c=o(await n(r,i,l)),d=c.contentDocument||c.contentWindow&&c.contentWindow.document;return d?a(c,d):console.error("Iframe document not found"),s(c)}).catch(e=>{console.error(e)});let e=async e=>{let t="".concat(r.toc[i].path?r.toc[i].path+"/":"").concat(decodeURIComponent(r.toc[i].file)),n=e.file(t);if(n)return{chapterContent:await n.async("string"),zip:e,basePath:r.toc[i].path};throw Error("Content file not found")},n=async(e,t,r)=>{let n=new DOMParser,o=n.parseFromString(e,"application/xml");if(!o)throw Error("Failed to parse chapter content");let i=n.parseFromString(o.documentElement.outerHTML,"application/xml");for(let e of Array.from(i.querySelectorAll('link[rel="stylesheet"]'))){let n=f(r,e.getAttribute("href")||""),o=t.file(n);if(o){let t=await o.async("blob"),r=URL.createObjectURL(t);e.setAttribute("href",r)}}for(let e of Array.from(i.querySelectorAll("img"))){let n=f(r,e.getAttribute("src")||""),o=t.file(n);if(o){let t=await o.async("blob"),r=URL.createObjectURL(t);e.setAttribute("src",r)}}return new XMLSerializer().serializeToString(i)},o=e=>{let t=document.getElementById("epub-renderer");if(!t||!t.contentWindow)throw Error("Renderer not found");let r=t.contentDocument||t.contentWindow&&t.contentWindow.document;r.open(),r.write(e),r.close();let n=r.createElement("style"),o=t.scrollWidth?t.scrollWidth/3.5:0;return n.innerHTML="\n        body {\n          columns: 2;\n          column-fill: auto;\n          word-wrap: break-word;\n          overflow: hidden;\n          column-gap: 20px;\n        }\n  \n        a {\n          text-decoration: none;\n        }\n  \n        img {\n          max-width: ".concat(o,"px;\n          height: auto;\n        }\n      "),r.head.appendChild(n),t},a=(e,t)=>{Promise.all(Array.from(t.images).map(e=>new Promise(t=>{e.complete?t(void 0):(e.addEventListener("load",t),e.addEventListener("error",t))}))).then(()=>{if(!(null==e?void 0:e.contentWindow)){console.error("Renderer not found");return}})},s=e=>{e.style.visibility="hidden";let t=()=>{var r;let n=e.contentDocument||(null===(r=e.contentWindow)||void 0===r?void 0:r.document);if(!n||!e.contentWindow)throw Error("Iframe document not found");if(n.body){let r=e.contentWindow.document.body,o=e.contentWindow.getComputedStyle(r),i=parseFloat(o.marginLeft),l=parseFloat(o.marginRight),a=r.clientWidth-i-l+20;a!==u.current&&(u.current=a);let s=n.body.scrollWidth,f=s/u.current;if(f-Math.floor(f)<=.5){let t=e.contentWindow.document.createElement("div");t.style.height="100%",r.appendChild(t)}h.current=Math.ceil(s/u.current),d.current?(e.contentWindow.scrollTo({left:(h.current-1)*u.current}),d.current=!1,c(Math.ceil(s/u.current))):e.contentWindow.scrollTo({left:0}),e.style.visibility="visible",e.removeEventListener("load",t)}};e.addEventListener("load",t)}},[t,r.toc,i]);let v=()=>{let e=document.getElementById("epub-renderer");return(null==e?void 0:e.contentWindow)?e.contentWindow:(console.error("Renderer not found"),null)};return(0,n.jsxs)("div",{style:{height:"100%",position:"relative"},children:[(0,n.jsx)("iframe",{id:"epub-renderer",style:{width:"100%",height:"100%"}}),(0,n.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between"},children:[(0,n.jsxs)(m,{variant:"outline",onClick:()=>{if(1!==s||0!==i){if(1===s&&i>0)d.current=!0,a(i-1);else if(s>1){let e=v();if(!e)return;e.scrollTo({left:(s-2)*u.current}),c(s-1)}}},children:[(0,n.jsx)(p.Z,{}),"Previous"]}),(0,n.jsxs)(m,{variant:"outline",onClick:()=>{let e=v();e&&(s<h.current?(e.scrollTo({left:s*u.current}),c(s+1)):i<r.toc.length-1&&(c(1),a(i+1)))},children:["Next",(0,n.jsx)(x.Z,{})]})]}),(0,n.jsx)("div",{style:{position:"absolute",right:"-120px",bottom:"0px"},children:(0,n.jsx)(F,{bookBasicInfo:r,currentChapter:i,setCurrentChapter:a})})]})};let R="application/xml",P=async e=>{let t=new FileReader;return new Promise((r,n)=>{t.onload=async function(e){try{var t,o,i,a;let n=null===(t=e.target)||void 0===t?void 0:t.result,s=await l().loadAsync(n),c=await (null===(o=s.file("META-INF/container.xml"))||void 0===o?void 0:o.async("string")),d=W(c),u=null==d?void 0:d.split("content.opf")[0];if(!c)throw Error("Missing container.xml in EPUB structure.");if(!d)throw Error("Failed to find content.opf path in container.xml.");let f=await (null===(i=s.file(d))||void 0===i?void 0:i.async("string")),[h,m]=z(f),p=s.file("".concat(u).concat(h.coverPath));if(!p)throw Error("Failed to find cover image in EPUB structure.");let[x,v]=await Promise.all([p.async("blob"),null===(a=s.file("".concat(u).concat(m)))||void 0===a?void 0:a.async("string")]);h.coverBlob=x,h.toc=I(v,u),r(h)}catch(e){console.error("Error reading EPUB file:",e),n(e)}},t.readAsArrayBuffer(e)})},W=e=>{try{let t=new DOMParser().parseFromString(e,R).querySelector("rootfile");if(t)return t.getAttribute("full-path")}catch(e){console.error("Error parsing XML:",e)}return null},z=e=>{var t;let r=new DOMParser().parseFromString(e,R);if(!r)throw Error("Failed to parse content.opf XML.");return[{title:(()=>{let e=r.querySelector("metadata > title");return(null==e?void 0:e.textContent)||""})(),creator:(()=>{let e=r.querySelector("metadata > creator");return(null==e?void 0:e.textContent)||""})(),publisher:(()=>{let e=r.querySelector("metadata > publisher");return(null==e?void 0:e.textContent)||""})(),identifier:(()=>{let e=r.querySelector("metadata > identifier");return(null==e?void 0:e.textContent)||""})(),date:(()=>{let e=r.querySelector("metadata > date");return(null==e?void 0:e.textContent)||""})(),coverPath:(()=>{let e=r.querySelector("metadata > meta[name='cover']"),t=e&&e.getAttribute("content")||"";if(t){let e=r.querySelector("manifest > item[id='".concat(t,"']"));return e&&e.getAttribute("href")||""}return""})(),coverBlob:null,toc:[]},null===(t=r.querySelector("manifest > item[id='ncx']"))||void 0===t?void 0:t.getAttribute("href")]},I=(e,t)=>{let r=[];return new DOMParser().parseFromString(e,R).querySelectorAll("navPoint").forEach(e=>{var n,o;let i=(null===(n=e.querySelector("navLabel > text"))||void 0===n?void 0:n.textContent)||"",l=(null===(o=e.querySelector("content"))||void 0===o?void 0:o.getAttribute("src"))||"",a=(l?"".concat(t).concat(l):"").split("/"),s=a.pop()||"",c=a.join("/");r.push({text:i,path:c,file:s})}),r},M=o.forwardRef((e,t)=>{let{className:r,type:o,...i}=e;return(0,n.jsx)("input",{type:o,className:u("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...i})});M.displayName="Input";let U={normal:{y:0},animate:{y:2,transition:{type:"spring",stiffness:200,damping:10,mass:1}}},_=()=>{let e=(0,C._)();return(0,n.jsx)("div",{className:"cursor-pointer select-none p-2 rounded-md transition-colors duration-200 flex items-center justify-center",onMouseEnter:()=>e.start("animate"),onMouseLeave:()=>e.start("normal"),children:(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,n.jsxs)(N.E.g,{variants:U,animate:e,children:[(0,n.jsx)("polyline",{points:"7 10 12 15 17 10"}),(0,n.jsx)("line",{x1:"12",x2:"12",y1:"15",y2:"3"})]})]})})};r(8345);var q=r(7055),D=function(){let e=(0,o.useRef)(null),[t,r]=(0,o.useState)({fileInfo:{name:"",size:0,blob:null},bookBasicInfo:null}),i=async e=>{let t=e.target.files;if(!t)return;let n=t[0];if(n){let e=(n.size/1048576).toFixed(2),t=await new Promise((e,t)=>{let r=new FileReader;r.onload=()=>{e(r.result)},r.onerror=()=>{t(Error("Error reading file"))},r.readAsArrayBuffer(n)}),o=await P(n);r({fileInfo:{name:n.name,size:parseFloat(e),blob:t},bookBasicInfo:{...o}})}},l=(e,t)=>{let r=document.createElement("a");r.href=e,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r)};return(0,n.jsxs)("div",{className:"app",children:[(0,n.jsxs)("div",{className:"uploadEpub",children:[(0,n.jsx)(M,{id:"picture",type:"file",accept:".epub",ref:e,style:{display:"none"},onChange:i}),(0,n.jsxs)("div",{className:"flex w-full justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(m,{type:"button",onClick:()=>{e.current&&e.current.click()},children:"Select EPUB"}),(0,n.jsxs)("span",{style:{marginLeft:"10px"},children:[t.fileInfo.name," ",t.fileInfo.name?"".concat(t.fileInfo.size,"MB"):null]})]}),(0,n.jsx)(m,{variant:"outline",size:"icon",onClick:()=>window.open("https://github.com/jhao0413/react-epub-parser","_blank"),children:(0,n.jsx)(q.Z,{})})]})]}),(0,n.jsx)("div",{style:{height:"100%"},children:t.bookBasicInfo?(0,n.jsx)(L,{blob:t.fileInfo.blob,bookBasicInfo:t.bookBasicInfo}):(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-center mb-2",children:[(0,n.jsx)(v.default,{src:"https://jhao413.oss-cn-beijing.aliyuncs.com/epub-parser-logo.png",width:60,height:60,alt:""}),(0,n.jsx)("h1",{className:"text-3xl font-bold ml-2",children:"EPUB Reader Parser"})]}),(0,n.jsx)("p",{children:"This is a simple, open-source EPUB reader and parser that enables you to upload an EPUB file and read its content directly in your browser."}),(0,n.jsx)("p",{className:"font-bold text-xl mt-4",children:"Example EPUB files download"}),(0,n.jsxs)("div",{className:"flex mt-2",children:[(0,n.jsxs)(m,{onClick:()=>l("https://jhao413.oss-cn-beijing.aliyuncs.com/%E5%B2%A9%E7%94%B0%E5%85%88%E7%94%9F_%E4%BB%BB%E5%A4%A9%E5%A0%82%E4%BC%A0%E5%A5%87%E7%A4%BE%E9%95%BF%E5%A6%82%E6%98%AF%E8%AF%B4(%E5%85%A8%E7%90%83%E6%8E%88%E6%9D%8310%E8%AF%AD%E7%A7%8D!%E4%BB%8E%E5%A4%A9%E6%89%8D%E7%A8%8B%E5%BA%8F%E5%91%98%2C%E5%88%B0%E4%B8%96%E7%95%8C%E9%A1%B6%E5%B0%96%E4%BC%81%E4%B8%9A%E7%AE%A1%E7%90%86%E8%80%85%2C%E6%89%AD%E8%BD%AC%E9%A2%93%E5%8A%BF%2C.epub","岩田先生_任天堂传奇社长如是说.epub"),children:[(0,n.jsx)(_,{}),"岩田先生_任天堂传奇社长如是说.epub"]}),(0,n.jsxs)(m,{className:"ml-2",onClick:()=>l("https://jhao413.oss-cn-beijing.aliyuncs.com/%E5%BE%81%E6%9C%8D%E4%B8%96%E7%95%8C%E5%AE%8C%E5%85%A8%E6%89%8B%E5%86%8C%20tg%40sharebooks4you.epub","征服世界完全手册.epub"),children:[(0,n.jsx)(_,{}),"征服世界完全手册.epub"]})]})]})})})]})}},8345:function(){}},function(e){e.O(0,[940,432,971,23,744],function(){return e(e.s=6993)}),_N_E=e.O()}]);